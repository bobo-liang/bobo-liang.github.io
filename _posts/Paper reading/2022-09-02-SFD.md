---
layout: post
title: 'Sparse Fuse Dense: Towards High Quality 3D Detection with Depth Completion'
date: 2022-09-03
author: Poley
cover: '/assets/img/20220903/SFD.jpg'
tags: 论文阅读
---

本文发表于CVPR2022，是一种基于图像和点云融合的目标检测方法。主要针对三个问题提出了解决方案：
+ 特征融合的对齐方式。传统方法是分别在两种模态中提取ROI特征并直接串联，是一种coarse的对齐方式。以更准确的结合多模态信息
+ 多模态训练的增广方式。由于多模态信息需要保持一致，因此常见的用于点云的数据增强方法并不能应用于多模态方法，限制了网络训练的性能。本文提出的方法将GT-AUG和Paramid Aug成功引入了多模态检测网络中，显著的提升了性能
+ 上述方法都基于本文中以伪点云形式处理图片。为了从3D伪点云中提取2D图像的语义特征，提出CPConv来实现卷积操作。


传统的直接拼接2D ROI和3D ROI特征是一种Coasrse的方法。2D ROI往往夹杂前景和背景，同时也忽略了2D和3D object part的对应关系。一种细粒度的融合方法是通过点云来索引对应的图像特征。但是点云太稀疏了，这样索引到的图像特征有限。本文针对这个问题提出3D-GAF，在准确对齐两者特征的同时，通过Attention自适应的决定两者特征在最终ROI特征中的权重。

针对多模态模型数据增广不足的问题（点云和图像的增强不通用），提出SynAugnment。通过伪点云，以点云的增强方式处理图像。通过伪点云的方式，可以将图像按点云处理。但是要考虑到遮挡问题对FOV特征提取的影响。这里提出直接在3D空间中提取图像特征，从而避免FOV的遮挡。

进一步的，提出CPConv实现从上述伪点云中实现特征提取。使用图像坐标完成对体素近邻在FOV上的搜索。考虑到遮挡关系，这里指将各个RoI中的点云投影到图像中。

本文利用了深度补全技术，深度补全用于结合点云在图像中的稀疏投影，为图像预测一个稠密的深度图（伪点云）。一些工作利用深度补全实现3D检测，但是其性能受到准确率和原始点云不足的影响。

本文提出方法的整体结构如下所示, 本文首先通过深度补全实现对图像对应的稠密点云的预测，而随后的所有处理都基于点云和伪点云进行。
![](/assets/img/20220903/SFDF1.jpg)

## 3D Grid-wise Attentive Fustion

本文方法的特点在于其以点云形式处理图像，因此可以实现在同以RoI中，点云和图像的Voxel网格可以实现grid-wise的对齐，即细粒度对齐。之后使用一个简单的注意力机制来动态判断两种的权重，加权融合。如下图所示

![](/assets/img/20220903/SFDF2.jpg)

对于RoI，其中的网格划分同Voxel-RCNN, 使用grid points聚合对应模态中的体素特征。这里也不是加权求和，是加权之后在MLP。如下所示
$$
\begin{equation}
\begin{gathered}
\left(w_i^{\mathrm{raw}}, w_i^{\mathrm{pse}}\right)=\sigma\left(\operatorname{MLP}\left(\operatorname{CONCAT}\left(F_i^{\mathrm{raw}}, F_i^{\mathrm{pse}}\right)\right)\right) \\
F_i=\operatorname{MLP}\left(\operatorname{CONCAT}\left(w_i^{\mathrm{raw}} F_i^{\mathrm{raw}}, w_i^{\mathrm{pse}} F_i^{\mathrm{pse}}\right)\right)
\end{gathered}
\end{equation}
$$

## Synchronized Augmentation
个人认为这是本文最重要的创新，即如何以伪点云的方式处理图像，实现对点云和图像的同时增强。

分为两部分：1、像点云一样操作图像；2、从3D空间中提取图像特征。

首先，通过深度补全和点云上色，可以保留图像的全部信息。传统的，从FOV提取图像特征会限制数据增广的方法，由于遮挡效应。从3D处理可以避免这一点，更加灵活。常用的3D处理是稀疏卷积，考虑到这和图像稠密数据之间的关系，作者提出了更加有效率的方法。

有些方法考虑到了多模态中的FOV遮挡，并使用遮挡检测等方法。但是其还是不能解决其他的增广问题，比如局部噪声和SA-DA(SESSD中的Pyramid Aug).

还有些方法将图像分割得分投影到点云中来使用多模态数据增广。但是这样太稀疏了。相比这下，本方法是稠密的，因为可以从伪点云中crop下完整的图像信息。由于使用图像的伪点云进行处理，因此GT-SAMPLING变得可行。同时，由于伪点云和图像稠密数据之间的对应关系，可以实现基于图像坐标的快速检索。



![](/assets/img/20220903/SFDF3.jpg)

## Color Point Convlution

上述将图像按点云处理，显然不能直接将图像的2D卷积应用在点云上。一种简单的方法是使用3D卷积，或者使用Ball query的点方法来提取其中的语义信息，但是这样没有充分利用伪点云的语义信息和结构信息，同时带来的计算量也较大（Ball query在点云较多的情况下性能不佳）。受到来自于RangeDet和Voxel-RCNN，利用图像的索引关系，可以
+ 常数时间索引近邻；
+ 提取2D语义信息。


为了避免FOV上的遮挡关系，这里作者提出针对每个RoI,分别从其对应的图像域中提取图像特征（主要针对GT-AUG,将其他sample中的点云粘贴到当前点云中），如下图所示，这样可以保证每个目标对应的图像信息都是准确的，可以和点云对应的，而避免了FOV上的遮挡关系。如上图所示。

在位置残差信息上，同时引入3D和2D位置残差，来同时引入3D和2D的局部信息。使用相对位置信息生成权重，实现加权，并通过多层串联以实现更深的网络和特征表达。

![](/assets/img/20220903/SFDF4.jpg)

最终，在性能上，本文确实也实现了很高的性能(可能是Car类别的第一名)
![](/assets/img/20220903/SFDT1.jpg)